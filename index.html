<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Top-Down Flow ‚Äî Blue Theme (slow & left-to-right)</title>
<style>
  :root{
    /* „Éñ„É´„ÉºÂü∫Ë™ø */
    --bg:#ffffff;
    --wire:#1e40af;      /* Áü¢Âç∞ÔºàÊøÉ„ÅÑÈùíÔºâ */
    --b1:#2563eb;        /* 1st: Blue 600  */
    --b2:#0ea5e9;        /* 2nd: Sky 500   */
    --b3:#38bdf8;        /* 3rd: Sky 400   */
    --text:#0b2536;
    --panel:#ffffff;
    --border:#e6eef7;
    --shadow:0 16px 40px rgba(2,33,70,.08);
  }
  html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,"Segoe UI",Roboto,sans-serif}
  .wrap{max-width:1200px;margin:24px auto 120px;padding:0 18px;position:relative}

  /* Â∑¶‰∏ä„Éú„Çø„É≥ */
  .replay{
    position:fixed;left:16px;top:16px;z-index:10;
    border:0;background:var(--wire);color:#fff;padding:10px 14px;border-radius:12px;
    font-weight:800;cursor:pointer;box-shadow:0 10px 28px rgba(30,64,175,.28);letter-spacing:.02em
  }

  /* „Çø„Ç§„Éà„É´Â∏ØÔºàÊòé„Çã„ÇÅÔºâ */
  .banner{display:flex;justify-content:center;align-items:center;margin:0 0 14px}
  .banner span{letter-spacing:.08em;font-weight:900}
  .banner .hi{color:var(--b1)} .banner .lo{color:#4b6373}

  /* „É¨„Ç§„É§ */
  .layers{display:grid;gap:48px;position:relative}
  .layer{position:relative;padding:10px 10px 0}
  .row{display:flex;gap:20px;flex-wrap:nowrap;justify-content:center}

  /* „Ç´„Éº„ÉâÔºàÁôΩ„Éô„Éº„Çπ„Éª„Éñ„É´„ÉºÂ∏ØÔºâ */
  .card{
    min-width:260px; max-width:320px;
    background:var(--panel);
    border:1px solid var(--border); border-radius:16px;
    padding:16px 16px 14px; position:relative; box-shadow:var(--shadow);
    display:grid; grid-template-columns:46px 1fr; gap:10px; align-items:center;
  }
  .card .cap{position:absolute;inset:8px 8px auto 8px;height:8px;border-radius:10px;background:var(--band,#dbeafe)}
  .title{font-weight:900}
  .sub{font-size:13px;opacity:.8;margin-top:2px;line-height:1.35}
  .tag{margin-top:6px;font-weight:900;color:#073260;background:var(--band,#dbeafe);display:inline-block;padding:2px 8px;border-radius:999px}

  /* „Ç¢„Ç§„Ç≥„É≥ */
  .ico{
    width:46px;height:46px;border-radius:12px;background:#f5f9ff;
    display:grid;place-items:center;border:1px solid var(--border)
  }
  .ico svg{width:26px;height:26px}

  /* SVG ÈÖçÁ∑öÔºà„Éñ„É´„ÉºÔºâ */
  .svgLayer{position:absolute;inset:0;pointer-events:none;z-index:0}
  svg{width:100%;height:100%}
  .wire{stroke:var(--wire);stroke-width:3.2;fill:none;marker-end:url(#arrow);
        stroke-dasharray:1;stroke-dashoffset:1;filter:drop-shadow(0 1px 0 rgba(0,0,0,.18))}
  .joint{fill:#e2eaf5;stroke:#94a8bd;stroke-width:1.2}
</style>
</head>
<body>
<button class="replay" id="replay">START AGAIN</button>

<div class="wrap" id="wrap">
  <div class="banner">
    <span class="lo">BEFORE</span>&nbsp;<span class="hi">YOU</span>&nbsp;<span class="lo">ASSESS</span>
  </div>

  <div class="layers" id="layers">
    <!-- L0 -->
    <div class="layer" id="L0">
      <div class="row">
        <div class="card" id="start" style="--band:var(--b1)">
          <div class="cap"></div>
          <div class="ico" aria-hidden="true">
            <!-- Â∑•Â†¥/„Ç≠„É£„Éë -->
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M3 20V9l5 3V9l5 3V8l8 4v8H3Z" stroke="var(--b1)" stroke-width="2"/>
              <path d="M6 20v-4m3 4v-4m3 4v-4m3 4v-4m3 4v-4" stroke="#8fb6ff" stroke-width="1.5"/>
            </svg>
          </div>
          <div>
            <div class="title">EXCESS CAPACITY</div>
            <div class="sub">in a major market</div>
            <div class="tag">START</div>
          </div>
        </div>
      </div>
    </div>

    <!-- L1: 1st -->
    <div class="layer" id="L1">
      <div class="row">
        <div class="card" id="n1_prices" style="--band:var(--b1)">
          <div class="cap"></div>
          <div class="ico" aria-hidden="true">
            <!-- price down -->
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M7 4v12m0 0l-3-3m3 3l3-3" stroke="var(--b1)" stroke-width="2" stroke-linecap="round"/>
              <circle cx="15" cy="9" r="3.5" stroke="#8fb6ff"/>
            </svg>
          </div>
          <div>
            <div class="title">‚Üì PRICES</div>
            <div class="sub">First-order price reaction</div>
            <div class="tag">1st</div>
          </div>
        </div>

        <div class="card" id="n1_export" style="--band:var(--b1)">
          <div class="cap"></div>
          <div class="ico" aria-hidden="true">
            <!-- export ship -->
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M3 14h8l2-3h8l-2 6H6l-3-3Z" stroke="var(--b1)" stroke-width="2"/>
              <path d="M10 6l4 4M14 6l-4 4" stroke="#8fb6ff" stroke-width="1.6"/>
            </svg>
          </div>
          <div>
            <div class="title">‚Üë EXPORT</div>
            <div class="sub">Push to ship out surplus</div>
            <div class="tag">1st</div>
          </div>
        </div>
      </div>
    </div>

    <!-- L2: 2ndÔºàÂ∑¶‚ÜíÂè≥„ÅÆÈ†Ü„ÅßÊµÅ„Çå„ÇãÔºâ -->
    <div class="layer" id="L2">
      <div class="row" id="row2">
        <div class="card" id="n21_steelPrice" style="--band:var(--b2)">
          <div class="cap"></div>
          <div class="ico" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none">
              <rect x="3" y="8" width="14" height="4" rx="2" stroke="var(--b2)" stroke-width="2"/>
              <path d="M20 6v8m0 0l-2-2m2 2l2-2" stroke="#74d6f2" stroke-width="1.6" stroke-linecap="round"/>
            </svg>
          </div>
          <div><div class="title">‚Üì STEEL PRICES</div><div class="tag">2nd</div></div>
        </div>

        <div class="card" id="n22_steelGoods" style="--band:var(--b2)">
          <div class="cap"></div>
          <div class="ico" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M3 20v-6l4 2v-3l4 2v-4l6 3v6H3Z" stroke="var(--b2)" stroke-width="2"/>
              <circle cx="18.5" cy="8.5" r="2.5" stroke="#74d6f2"/>
            </svg>
          </div>
          <div><div class="title">‚Üë STEEL-BASED GOODS</div><div class="tag">2nd</div></div>
        </div>

        <div class="card" id="n23_exportSqueeze" style="--band:var(--b2)">
          <div class="cap"></div>
          <div class="ico" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M5 6h12v4H5z" stroke="var(--b2)" stroke-width="2"/>
              <path d="M7 10v8m10-8v8" stroke="#74d6f2" stroke-width="2"/>
            </svg>
          </div>
          <div><div class="title">‚Üë EXPORT SQUEEZE</div><div class="tag">2nd</div></div>
        </div>

        <div class="card" id="n24_detour" style="--band:var(--b2)">
          <div class="cap"></div>
          <div class="ico" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M5 18c8-1 2-10 14-11" stroke="var(--b2)" stroke-width="2"/>
              <path d="M17 5l4 3-4 3" fill="#74d6f2"/>
            </svg>
          </div>
          <div><div class="title">‚Üë DETOUR TRADE</div><div class="tag">2nd</div></div>
        </div>

        <div class="card" id="n25_policy" style="--band:var(--b2)">
          <div class="cap"></div>
          <div class="ico" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M4 18h10" stroke="#74d6f2" stroke-width="2"/>
              <path d="M9 6l5 5M11 4l5 5" stroke="var(--b2)" stroke-width="2"/>
              <path d="M16 10l4 4" stroke="#74d6f2" stroke-width="2"/>
            </svg>
          </div>
          <div><div class="title">‚Üë POLICY PUSHBACK</div><div class="tag">2nd</div></div>
        </div>
      </div>
    </div>

    <!-- L3: 3rdÔºàÂ∑¶‚ÜíÂè≥„ÅÆÈ†Ü„ÅßÊµÅ„Çå„ÇãÔºâ -->
    <div class="layer" id="L3">
      <div class="row">
        <div class="card" id="n31_marketShare" style="--band:var(--b3)">
          <div class="cap"></div>
          <div class="ico" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none">
              <circle cx="12" cy="12" r="7" stroke="var(--b3)"/>
              <path d="M12 5v7l5 5" stroke="#7bd3fb" stroke-width="2"/>
            </svg>
          </div>
          <div><div class="title">‚Üì MARKET SHARE</div><div class="tag">3rd</div></div>
        </div>

        <div class="card" id="n32_indirectExports" style="--band:var(--b3)">
          <div class="cap"></div>
          <div class="ico" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M4 8h8m0 0l-3-3m3 3l-3 3" stroke="var(--b3)" stroke-width="2"/>
              <path d="M12 16h8m0 0l-3-3m3 3l-3 3" stroke="#7bd3fb" stroke-width="2"/>
            </svg>
          </div>
          <div><div class="title">‚Üë INDIRECT EXPORTS</div><div class="tag">3rd</div></div>
        </div>

        <div class="card" id="n33_indirectTrade" style="--band:var(--b3)">
          <div class="cap"></div>
          <div class="ico" aria-hidden="true">
            <!-- üöó Ëªä„Ç¢„Ç§„Ç≥„É≥ -->
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M4 15l2-4a3 3 0 012.7-1.6h6.6A3 3 0 0118 11l2 4" stroke="var(--b3)" stroke-width="2" stroke-linejoin="round"/>
              <circle cx="8" cy="16.5" r="1.7" stroke="#7bd3fb" stroke-width="1.6"/>
              <circle cx="16" cy="16.5" r="1.7" stroke="#7bd3fb" stroke-width="1.6"/>
              <path d="M3 16.5h2m14 0h2" stroke="#7bd3fb" stroke-width="1.6" stroke-linecap="round"/>
            </svg>
          </div>
          <div><div class="title">‚Üë INDIRECT TRADE</div><div class="tag">3rd</div></div>
        </div>

        <div class="card" id="n34_reactionary" style="--band:var(--b3)">
          <div class="cap"></div>
          <div class="ico" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M12 4l9 16H3L12 4Z" stroke="var(--b3)" stroke-width="2"/>
              <path d="M12 9v5M12 18v.5" stroke="#7bd3fb" stroke-width="2"/>
            </svg>
          </div>
          <div><div class="title">‚Üë REACTIONARY TRADE</div><div class="tag">3rd</div></div>
        </div>
      </div>
    </div>
  </div>

  <!-- SVG: „Ç≥„Éç„ÇØ„Çø -->
  <div class="svgLayer">
    <svg id="svg">
      <defs>
        <marker id="arrow" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
          <path d="M0,0 L8,4 L0,8" fill="var(--wire)"/>
        </marker>
      </defs>
      <g id="wires"></g>
    </svg>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
<script>
/* Êé•Á∂öÔºàÈ†ÜÂ∫è„ÅØÂ∑¶‚ÜíÂè≥„ÅÆ„Ç¢„Éã„É°„Å´Âêà„Çè„Åõ„Å¶ÂàóÊåôÔºâ */
const EDGES = [
  ["start","n1_prices"], ["start","n1_export"],
  ["n1_prices","n21_steelPrice"], ["n1_prices","n22_steelGoods"],
  ["n1_export","n23_exportSqueeze"], ["n1_export","n24_detour"], ["n1_export","n25_policy"],
  // 2nd‚Üí3rd „Çí„ÄåL2 Â∑¶‚ÜíÂè≥„ÄçÈ†Ü„Åß„ÄÅÂêÑ„ÇΩ„Éº„Çπ„Åã„Çâ 3rd Â∑¶‚ÜíÂè≥„ÅÆ‰∏¶„Å≥„ÅßË®òËø∞
  ["n21_steelPrice","n31_marketShare"],
  ["n22_steelGoods","n31_marketShare"], ["n22_steelGoods","n32_indirectExports"],
  ["n23_exportSqueeze","n31_marketShare"], ["n23_exportSqueeze","n32_indirectExports"],
  ["n24_detour","n33_indirectTrade"], ["n24_detour","n34_reactionary"],
  ["n25_policy","n34_reactionary"]
];

const wrap = document.getElementById("wrap");
const wiresG = document.getElementById("wires");

/* ‰∏ã‚ÜíÊ®™‚Üí‰∏ãÔºà„Éú„ÉÉ„ÇØ„ÇπÁõ¥Ââç„ÅßÂÅúÊ≠¢Ôºâ */
function elbowPath(fromEl, toEl){
  const wb = wrap.getBoundingClientRect();
  const f = fromEl.getBoundingClientRect();
  const t = toEl.getBoundingClientRect();
  const sx = f.left + f.width/2 - wb.left;
  const sy = f.bottom - wb.top + 8;
  const tx = t.left + t.width/2 - wb.left;
  const ty = t.top - wb.top - 10;
  const my = (sy + (t.top - wb.top)) / 2, r = 10;
  const v1 = `M ${sx} ${sy} L ${sx} ${my-r}`;
  const c1 = `Q ${sx} ${my} ${sx+(tx>sx? r:-r)} ${my}`;
  const h  = `L ${tx-(tx>sx? r:-r)} ${my}`;
  const c2 = `Q ${tx} ${my} ${tx} ${my+r}`;
  const v2 = `L ${tx} ${ty}`;
  return `${v1} ${c1} ${h} ${c2} ${v2}`;
}

function drawWires(){
  wiresG.innerHTML = "";
  EDGES.forEach(([a,b])=>{
    const p = document.createElementNS("http://www.w3.org/2000/svg","path");
    p.setAttribute("class","wire");
    p.setAttribute("d", elbowPath(document.getElementById(a), document.getElementById(b)));
    wiresG.appendChild(p);

    // Ë¶ñË™çÊÄßÁî®„ÅÆ„Ç∏„Éß„Ç§„É≥„ÉàÔºà2ÁÇπÔºâ
    const wb = wrap.getBoundingClientRect();
    const fa = document.getElementById(a).getBoundingClientRect();
    const ta = document.getElementById(b).getBoundingClientRect();
    const cy = (fa.bottom - wb.top + ta.top - wb.top)/2;
    [ [fa.left+fa.width/2 - wb.left, cy-12],
      [ta.left+ta.width/2 - wb.left, cy+12] ].forEach(([cx,cy2])=>{
        const c = document.createElementNS("http://www.w3.org/2000/svg","circle");
        c.setAttribute("class","joint"); c.setAttribute("cx",cx); c.setAttribute("cy",cy2); c.setAttribute("r","4.2");
        wiresG.appendChild(c);
    });
  });
}

function prep(p){ const L=p.getTotalLength(); p.style.strokeDasharray=L; p.style.strokeDashoffset=L; }

/* „ÇÜ„Å£„Åè„Çä„ÉªÂ∑¶‚ÜíÂè≥ÔºöÂêÑ„É¨„Ç§„É§„Åß„Ç´„Éº„Éâ‚ÜíÈÖçÁ∑ö„ÅÆÈ†Ü„Å´ */
function play(){
  drawWires();

  const L0 = [document.getElementById("start")];
  const L1 = ["n1_prices","n1_export"].map(id=>document.getElementById(id));
  const L2 = ["n21_steelPrice","n22_steelGoods","n23_exportSqueeze","n24_detour","n25_policy"].map(id=>document.getElementById(id));
  const L3 = ["n31_marketShare","n32_indirectExports","n33_indirectTrade","n34_reactionary"].map(id=>document.getElementById(id));

  const wires = Array.from(document.querySelectorAll(".wire"));
  wires.forEach(prep);

  const tl = gsap.timeline({defaults:{ease:"power1.out"}});
  // ÂÖ®‰Ωì„Çí„Åï„Çâ„Å´„ÇÜ„Å£„Åè„Çä
  const showCards = (arr, st=.4, dur=.7)=> tl.to(arr,{opacity:1,y:0,stagger:st,duration:dur});

  // L0 ‚Üí 1st„Å∏„ÅÆÁ∑öÔºà2Êú¨Ôºâ
  gsap.set([ ...L0, ...L1, ...L2, ...L3 ], {opacity:0,y:12});
  showCards(L0, .4, .8);
  tl.to(wires.slice(0,2),{strokeDashoffset:0,stagger:.6,duration:1.6}, "+=0.2");

  // L1ÔºàÂ∑¶‚ÜíÂè≥Ôºâ ‚Üí L2„Å∏„ÅÆÁ∑öÔºàÂ∑¶‚ÜíÂè≥Ôºâ
  showCards(L1, .5, .8);
  tl.to(wires.slice(2,7),{strokeDashoffset:0,stagger:.55,duration:1.7}, "+=0.25");

  // L2ÔºàÂ∑¶‚ÜíÂè≥Ôºâ
  showCards(L2, .45, .85);
  // 2nd‚Üí3rd „ÅÆÈÖçÁ∑öÔºöEDGES„ÅÆ‰∏¶„Å≥„ÇíL2Â∑¶‚ÜíÂè≥„Å´„Åó„Å¶„ÅÇ„Çã„ÅÆ„Åß„ÄÅ„Åù„ÅÆ„Åæ„ÅæÈ†ÜÊ¨°
  tl.to(wires.slice(7),{strokeDashoffset:0,stagger:.55,duration:1.7}, "+=0.25");

  // L3ÔºàÂ∑¶‚ÜíÂè≥Ôºâ
  showCards(L3, .35, .8);
}

play();
window.addEventListener("resize", drawWires);
document.getElementById("replay").addEventListener("click", play);
</script>
</body>
</html>
