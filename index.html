<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Flow Diagram – layered cards + connectors</title>
<link rel="preconnect" href="https://cdn.jsdelivr.net">
<script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
<style>
  :root{
    --bg:#f5f8fb;
    --ink:#2b3a43;
    --accent1:#ff8a00;   /* オレンジ */
    --accent2:#09b0c7;   /* シアン */
    --accent3:#8f9aa7;   /* グレー */
    --card:#ffffff;
    --shadow:#cbd6e2;
    --wire:#5b6b78;
  }
  html,body{height:100%;margin:0;background:var(--bg);font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;color:var(--ink)}
  .wrap{max-width:1100px;margin:24px auto 100px;padding:0 16px;position:relative}
  h1{font-size:18px;margin:0 0 12px}

  /* ====== レイアウト ====== */
  .grid{
    display:grid;
    grid-template-columns: 360px 1fr; /* 左の円 + 右側の列 */
    gap:24px;
    align-items:start;
  }
  .right{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:28px 24px;
  }

  /* ====== 左の丸ノード ====== */
  .circle{
    position:sticky; top:16px;
    width:320px; aspect-ratio:1/1; border-radius:50%;
    background: radial-gradient(ellipse at 30% 30%, #ffffff 0%, #f1f5f9 70%);
    box-shadow: 0 18px 28px rgba(0,0,0,.12), inset 0 0 0 12px #fff, inset 0 0 0 1px #e4edf5;
    display:grid; place-items:center; text-align:center; font-weight:800;
  }
  .ring{position:absolute; inset:18px; border-radius:50%;
        background:
          conic-gradient(var(--accent1) 0 32%, transparent 0 50%, var(--accent2) 50% 82%, transparent 0);
    box-shadow: inset 0 0 0 12px #fff;
  }
  .circle h2{margin:0 0 4px}
  .dots{margin-top:8px; display:flex; gap:8px; justify-content:center}
  .dot{width:8px;height:8px;border-radius:50%}
  .dot.o{background:var(--accent1)} .dot.c{background:var(--accent2)} .dot.g{background:var(--accent3)}

  /* ====== 立体風カード ====== */
  .card{
    position:relative; padding:18px 18px 18px 20px; border-radius:18px;
    background:var(--card);
    box-shadow:
      0 14px 24px rgba(0,0,0,.14),
      inset 0 0 0 1px #dfe7f1;
    isolation:isolate;
  }
  /* カラーフレーム（上側に太い帯） */
  .card .frame{
    position:absolute; inset:10px; border-radius:14px; pointer-events:none;
    box-shadow: inset 0 0 0 10px var(--band, var(--accent3));
  }
  /* 影レイヤ（下に落ちる帯の影っぽさ） */
  .card::after{
    content:""; position:absolute; left:16px; right:16px; bottom:-10px; height:18px;
    background: radial-gradient( ellipse at 50% 0%, rgba(0,0,0,.18), transparent 70%);
    filter:blur(4px); z-index:-1; opacity:.65;
  }
  .title{font-weight:900; letter-spacing:.2px}
  .num{font-size:28px; font-weight:900; color:var(--band); margin-top:6px}

  /* 2列の上下交互配置を少しずらす（見た目を寄せる） */
  .right > :nth-child(odd){margin-top:12px}

  /* ====== 配線（SVG） ====== */
  .svgLayer{position:absolute; inset:0; pointer-events:none; z-index:0}
  svg{width:100%;height:100%}
  .node{fill:#fff; stroke:#c9d6e3; stroke-width:2}
  .wire{stroke:var(--wire); stroke-width:2; fill:none; marker-end:url(#arrow);
        stroke-dasharray:1; stroke-dashoffset:1}

  .replay{position:fixed; left:50%; bottom:16px; transform:translateX(-50%);
    border:0;background:var(--wire);color:#fff;padding:10px 16px;border-radius:12px;font-weight:700;cursor:pointer;
    box-shadow:0 8px 22px rgba(0,0,0,.16)}
</style>
</head>
<body>
<div class="wrap" id="wrap">
  <h1>Flow Diagram（インフォグラフィック風）</h1>

  <div class="grid" id="grid">
    <!-- 左の丸 -->
    <div class="circle" id="circle">
      <div class="ring"></div>
      <div style="position:relative; z-index:1;">
        <h2>INFOGRAPHIC<br>ELEMENTS</h2>
        <div class="dots"><span class="dot o"></span><span class="dot c"></span><span class="dot g"></span></div>
      </div>
    </div>

    <!-- 右側のカード群 -->
    <div class="right" id="cards">
      <!-- 1 -->
      <div class="card" data-band="var(--accent1)" id="c1">
        <div class="frame" style="--band:var(--accent1)"></div>
        <div class="title">IDEA</div>
        <div class="num">01</div>
        <div class="text">Describe the initial concept or insight that kicks off the process.</div>
      </div>
      <!-- 2 -->
      <div class="card" data-band="var(--accent1)" id="c2">
        <div class="frame" style="--band:var(--accent1)"></div>
        <div class="title">LOREM IPSUM</div>
        <div class="num">—</div>
        <div class="text">Short supportive description goes here.</div>
      </div>
      <!-- 3 -->
      <div class="card" data-band="var(--accent2)" id="c3">
        <div class="frame" style="--band:var(--accent2)"></div>
        <div class="title">BRAINSTORM</div>
        <div class="num">02</div>
        <div class="text">Collect ideas and quickly evaluate options.</div>
      </div>
      <!-- 4 -->
      <div class="card" data-band="var(--accent2)" id="c4">
        <div class="frame" style="--band:var(--accent2)"></div>
        <div class="title">DOLOR SIT AMET</div>
        <div class="num">—</div>
        <div class="text">Auxiliary notes or references.</div>
      </div>
      <!-- 5 -->
      <div class="card" data-band="var(--accent3)" id="c5">
        <div class="frame" style="--band:var(--accent3)"></div>
        <div class="title">DEADLINE</div>
        <div class="num">03</div>
        <div class="text">Define milestones and due dates.</div>
      </div>
      <!-- 6 -->
      <div class="card" data-band="var(--accent3)" id="c6">
        <div class="frame" style="--band:var(--accent3)"></div>
        <div class="title">GOAL</div>
        <div class="num">04</div>
        <div class="text">Clarify the outcome and success criteria.</div>
      </div>
    </div>
  </div>

  <!-- SVG: 配線とジョイント -->
  <div class="svgLayer">
    <svg id="svg">
      <defs>
        <marker id="arrow" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
          <path d="M0,0 L8,4 L0,8" fill="var(--wire)"/>
        </marker>
      </defs>
      <g id="wires"></g>
    </svg>
  </div>

  <button class="replay" id="replay">▶ もう一度再生</button>
</div>

<script>
/* 配線ルール：左の円 → 各カード（直交配線＋小さな丸ジョイント） */
const pairs = [
  "c1","c2","c3","c4","c5","c6" // 円からこの順に配線
];

const wrap = document.getElementById("wrap");
const svgG  = document.getElementById("wires");

function drawAll(){
  svgG.innerHTML = "";
  const circle = document.getElementById("circle").getBoundingClientRect();
  const wrapB  = wrap.getBoundingClientRect();

  pairs.forEach((id, idx)=>{
    const el = document.getElementById(id);
    const r = el.getBoundingClientRect();

    // 円の右側の適当な高さから出発（上段/下段で高さをずらす）
    const sx = circle.right - wrapB.left - 6;
    const sy = circle.top   - wrapB.top + circle.height*(0.25 + 0.12*idx);

    // カードの左中央に入るが、わずかに手前で停止
    const tx = r.left - wrapB.left - 14;
    const ty = r.top  - wrapB.top + r.height/2;

    // 途中ジョイント点（円を出たあと水平→小丸→水平→小丸→カードへ）
    const j1x = sx + 48;
    const j2x = (j1x + tx)/2;

    // 丸ノード
    [ [j1x,sy], [j2x,sy] ].forEach(([cx,cy])=>{
      const c = document.createElementNS("http://www.w3.org/2000/svg","circle");
      c.setAttribute("class","node");
      c.setAttribute("cx", cx); c.setAttribute("cy", cy); c.setAttribute("r", 8);
      svgG.appendChild(c);
      const dot = document.createElementNS("http://www.w3.org/2000/svg","circle");
      dot.setAttribute("cx", cx); dot.setAttribute("cy", cy); dot.setAttribute("r", 2.2);
      dot.setAttribute("fill", "#6b7c8a");
      svgG.appendChild(dot);
    });

    // パス（直線＋角の丸み）
    const rCorner = 10;
    function segPath(x1,y1,x2,y2){ return `M ${x1} ${y1} L ${x2} ${y2}`; }
    function elbow(x,y,dir){ // dir: +1 (右) or -1 (左)
      return `M ${x} ${y-rCorner} Q ${x} ${y} ${x+(rCorner*dir)} ${y}`;
    }

    const p = document.createElementNS("http://www.w3.org/2000/svg","path");
    let d = "";
    d += segPath(sx,sy, j1x-8, sy);               // 円→j1手前
    d += " " + elbow(j1x-8, sy, +1);              // 曲げ
    d += segPath(j1x+8, sy, j2x-8, sy);           // j1→j2手前
    d += " " + elbow(j2x-8, sy, +1);              // 曲げ
    d += segPath(j2x+8, sy, tx, ty);              // 斜めでカード手前へ
    p.setAttribute("d", d);
    p.setAttribute("class","wire");
    svgG.appendChild(p);
  });
}

function prep(p){
  const len = p.getTotalLength();
  p.style.strokeDasharray = len;
  p.style.strokeDashoffset = len;
}

function animateIn(){
  // カードをフェードイン
  const cards = Array.from(document.querySelectorAll(".card"));
  gsap.set(cards,{opacity:0,y:8});
  gsap.to(cards,{opacity:1,y:0,stagger:0.08,duration:.45,ease:"power2.out"});

  // 配線アニメ
  const wires = Array.from(document.querySelectorAll(".wire"));
  wires.forEach(prep);
  gsap.to(wires,{strokeDashoffset:0,stagger:0.06,duration:.9,ease:"power2.out",delay:.05});
}

function play(){
  drawAll();
  animateIn();
}

play();
window.addEventListener("resize", drawAll);
document.getElementById("replay").addEventListener("click", play);
</script>
</body>
</html>
